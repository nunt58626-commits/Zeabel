async function loadHistoryFromGitHub() {
    const container = document.getElementById('historyTableContainer');
    const url = 'https://raw.githubusercontent.com/nunt58626-commits/Zeabel/main/data/stock-history.json';

    try {
        const res = await fetch(url);
        if (!res.ok) throw new Error('ไม่สามารถโหลดข้อมูลจาก GitHub ได้');
        const data = await res.json();

        if (data.length === 0) {
            container.innerHTML = '<p class="text-center mt-3">ยังไม่มีประวัติการเคลื่อนย้ายสินค้า</p>';
            return;
        }

        let tableHTML = `
          <div class="table-responsive">
          <input type="text" id="searchInput" class="form-control mb-2" placeholder="ค้นหารหัสสินค้า">
          <table class="table table-striped table-bordered">
            <thead class="table-dark">
              <tr>
                <th>รหัสสินค้า</th>
                <th>จำนวนลัง</th>
                <th>จากตำแหน่ง</th>
                <th>ไปตำแหน่ง</th>
                <th>วันผลิต</th>
                <th>วันหมดอายุ</th>
                <th>เวลาบันทึก</th>
              </tr>
            </thead>
            <tbody id="historyTableBody">
        `;

        data.forEach(item => {
            tableHTML += `
              <tr>
                <td>${item.productCode}</td>
                <td>${item.quantity}</td>
                <td>${item.from}</td>
                <td>${item.to}</td>
                <td>${item.mfg}</td>
                <td>${item.exp}</td>
                <td>${new Date(item.timestamp).toLocaleString()}</td>
              </tr>
            `;
        });

        tableHTML += '</tbody></table></div>';
        container.innerHTML = tableHTML;

        // เพิ่มฟังก์ชันค้นหา
        document.getElementById('searchInput').addEventListener('input', function() {
            const filter = this.value.toLowerCase();
            const rows = document.querySelectorAll('#historyTableBody tr');
            rows.forEach(row => {
                row.style.display = row.cells[0].textContent.toLowerCase().includes(filter) ? '' : 'none';
            });
        });

    } catch (err) {
        container.innerHTML = `<p class="text-center mt-3 text-danger">${err.message}</p>`;
    }
}

document.addEventListener('DOMContentLoaded', loadHistoryFromGitHub);
